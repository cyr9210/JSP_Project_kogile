<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kogile.post.Mapper.PostMapper">
	<cache />

	<!-- DML(insert, update, delete)은 resultType을 주지 않아도 된다. -->
	<!-- DML은 DML 태그를 꼭 사용해서 resultType을 생략해야한다. -->
	<!-- #{컬럼명}은 해당 컬럼의 정보를 참고하여 반응한다. -->

	<!-- insert -->
	<insert id="insertPost" parameterType="PostDTO">
		insert into post
		values(post_seq.nextval, #{p_title}, 1, #{c_no})
	</insert>

	<!-- 회원 정보를 Post까지 가져가기 -->
	<!-- 가져가기 위해서 charge_info에 post, 회원 정보를 담는다. -->
	<insert id="chargeInfo" parameterType="ChargeDTO">
		insert into charge_info
		values(charge_info_no_seq.nextval, #{info_no}, #{p_no})
	</insert>

	<!-- 가장 최근에 생긴 Post의 no를 구하기 -->
	<select id="selectPost" resultType="int">
		select p_no from post
		where
		rownum = 1
		order by p_no desc
	</select>

	<!-- list -->
	<select id="listPost" resultType="PostDTO">
		select * From post order by
		p_no
	</select>

	<!-- detail 제목 read -->
	<select id="detailPost" resultType="PostDTO">
		SELECT p_no, p_title
		FROM post
		WHERE p_no = #{p_no}
		<!-- SELECT p.p_title, d.d_contents, c.check_title, r.r_contents FROM post 
			p JOIN description d ON p.p_no = d.p_no JOIN checklist c ON d.p_no = c.p_no 
			JOIN list l ON c.checklist_no = l.checklist_no JOIN label b ON p.p_no = b.p_no 
			JOIN reply r ON d.d_no = r.d_no WHERE p_no = #{p_no} -->
	</select>
	
	<select id="detailSupervisor" resultType="MemberDTO">
		
	
	</select>

	<!-- update -->
	<!-- p_no의 p_title을 가져와 p_title을 입력받아서 수정한다. -->
	<update id="updatePost" parameterType="PostDTO">
		update post set p_title =
		#{p_title}
		where p_no = #{p_no}
	</update>


	<!-- delete -->
	<delete id="deletePost" parameterType="PostDTO">
		delete from post where
		p_no = #{p_no}
	</delete>

	<!-- 내부회원 checkbox -->
	<select id="inter_member" parameterType="int"
		resultType="MemberDTO">
		select i.member_name as name, i.email as email,
		t.total_m_no as total_no
		from inter_m_info i
		join total_member t
		on t.member_no = i.member_no
		join invite v
		on t.total_m_no = v.total_m_no
		where v.pjt_no = #{pjt_no}
	</select>

	<!-- 외부회원 chechbox -->
	<select id="exter_member" parameterType="int"
		resultType="MemberDTO">
		select e.exter_mem_name as name, e.exter_m_email as email,
		t.total_m_no as total_no
		from external_m_info e 
		join total_member t
		on t.exter_m_no = e.exter_m_no
		join invite v
		on t.total_m_no = v.total_m_no
		where v.pjt_no = #{pjt_no}
	</select>

	<!-- 프로젝트 번호에 따른 Card정보 가져오기 -->
	<select id="card_info" resultType="CardDTO">
		select distinct c_title, c_no
		from card
		order by c_no
	</select>

</mapper>